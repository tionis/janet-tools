(use spork/test spork/misc)
(import ../gp/data/store)
(start-suite "Documentation")
(assert-docs "../gp/data/store")
(end-suite)

(start-suite "Store")

(defer (os/rm "store.jimage")
  (def s (make store/Store))
  (assert s "make store")
  (assert (:init s) "init store")
  (assert-error "Must prepare containers" (:save s true :a :b :c))
  (assert (:save s @{} :a))
  (assert (:save s @{} :a :b))
  (assert (:save s true :a :b :c))
  (assert (:load s :a :b :c))
  (assert (:flush s) "flush store")
  (assert (:load (:init (make store/Store)) :a :b :c))
  (assert (not (:load (:init (make store/Store)) :d))))
(end-suite)
